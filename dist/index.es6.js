/*!
 * wiscroll v0.1.2 (ES6 Module version)
 * (c) Tom Chen <tomchen.org@gmail.com>, MIT license
 */
const _a={top:"0%",bottom:"100%"},_b={top:{up:!0,down:!1,in:!0,out:!1},bottom:{up:!1,down:!0,in:!0,out:!1}},_c={top:{in:!0,out:!1,up:!0,down:!1},bottom:{in:!1,out:!0,up:!0,down:!1}},_d=(t,o,e,r)=>{const i=/(-{0,1})(.+)(px|%)/.exec(t);let s,n=i[3],l=i[2];const h=o.innerHeight||o.getBoundingClientRect().height;if("px"===r&&"%"===n&&(l=l*h/100,n="px"),s="px"===n?h-l:100-l,"-"===i[1]){const t=s;s=l,l=t}return{_g:l,_h:s,_i:n}},_e=(t,o)=>{let e,r,i,s,n,l=null,h=0;const u=()=>{h=0,l=null,i=t.apply(e,r),l||(e=null,r=null)};return(...c)=>(s=Date.now(),h||(h=s),e=this,r=c,(n=o-(s-h))<=0||n>o?(l&&(clearTimeout(l),l=null),h=s,i=t.apply(e,r),l||(e=null,r=null)):l||(l=setTimeout(u,n)),i)},_f={init:null,in:null,out:null,delay:150,fromIsBelowTo:!0};class Wiscroll{constructor(t,o=null){this.target=t,this.root=o,this.rootEl=o||window,this.observers=[],this.listeners=[]}observe(t,o,e,r,i){let s,n=t;n in _a&&(n=_a[n]);const l=_b[o][e],h=_c[o][e],{_g:u,_h:c,_i:d}=_d(n,this.rootEl,h),a=this.rootEl.innerHeight||this.rootEl.getBoundingClientRect().height,p=h?`${this.target.getBoundingClientRect().height+a}px`:`-${u}${d}`,g=h?`-${c}${d}`:`${this.target.getBoundingClientRect().height+a}px`,m=l?0:1,w=new IntersectionObserver(t=>{t.forEach(t=>{if(void 0===s&&"function"==typeof i&&i.call(this,t.rootBounds[h?"bottom":"top"]>t.boundingClientRect[o],t),t.isIntersecting){let o;const e=t.boundingClientRect.y;e>s?o=!1:e<s&&(o=!0),o===h&&!0===t.isIntersecting&&"function"==typeof r&&r.call(this,t)}s=t.boundingClientRect.y})},{root:this.root,threshold:[m],rootMargin:`${p} 0% ${g}`});return w.observe(this.target),this.observers.push(w),this}cancel(){return this.observers.forEach(t=>{t.unobserve(this.target)}),this.listeners.forEach(t=>{window.removeEventListener("scroll",t,!1)}),this}on(t,o,e){const[r,i,s]=t.split(" ");let n=e;return void 0===s?"function"==typeof o?(this.observe(r,i,"up",o,(t,e)=>{t?o(e):n(e)}),this.observe(r,i,"down",t=>{n(t)})):(n=void 0===n||n,this.observe(r,i,"up",()=>{this.target.classList[n?"add":"remove"](...o.split(" "))},t=>{t?this.target.classList[n?"add":"remove"](...o.split(" ")):this.target.classList[n?"remove":"add"](...o.split(" "))}),this.observe(r,i,"down",()=>{this.target.classList[n?"remove":"add"](...o.split(" "))})):this.observe(r,i,s,o,n),this}init(t,o){const[e,r]=t.split(" ");return this.observe(e,r,"up",null,(t,e)=>{o.call(this,t,e)}),this}fromto(t,o,e,r){const[i,s]=t.split(" "),[n,l]=o.split(" "),h={..._f,...r||{}};let u,c;const d=_d(i,this.rootEl,h.fromIsBelowTo,"px")._g;let a=_d(n,this.rootEl,!h.fromIsBelowTo,"px")._g-d;"top"===s&&"bottom"===l?a-=this.target.getBoundingClientRect().height:"bottom"===s&&"top"===l&&(a+=this.target.getBoundingClientRect().height);const p=()=>(this.target.getBoundingClientRect()[s]-d)/a;return this.observe(i,s,h.fromIsBelowTo?"up":"down",t=>{u=_e(()=>{e.call(this,p(),t)},h.delay),h.in&&h.in.call(this,p(),t),window.addEventListener("scroll",u,!1),c=this.listeners.push(u)-1},(t,o)=>{const r=p();h.init&&h.init.call(this,r,o),r>0&&r<1&&(u=_e(()=>{e.call(this,p(),o)},h.delay),h.in&&h.in.call(this,p(),o),window.addEventListener("scroll",u,!1),c=this.listeners.push(u)-1)}),this.observe(n,l,h.fromIsBelowTo?"down":"up",t=>{u=_e(()=>{e.call(this,p(),t)},h.delay),h.in&&h.in.call(this,p(),t),window.addEventListener("scroll",u,!1),c=this.listeners.push(u)-1}),this.observe(n,l,h.fromIsBelowTo?"up":"down",t=>{window.removeEventListener("scroll",u,!1),delete this.listeners[c],h.out&&h.out.call(this,p(),t)}),this.observe(i,s,h.fromIsBelowTo?"down":"up",t=>{window.removeEventListener("scroll",u,!1),delete this.listeners[c],h.out&&h.out.call(this,p(),t)}),this}fromTo(...t){return this.fromto(t),this}}export default Wiscroll;