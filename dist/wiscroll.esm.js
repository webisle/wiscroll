/*!
 * wiscroll v0.1.4 (ES6 Module version)
 * (c) Tom Chen <tomchen.org@gmail.com>, MIT license
 */
const t={top:"0%",bottom:"100%"},o={top:{up:!0,down:!1,in:!0,out:!1},bottom:{up:!1,down:!0,in:!0,out:!1}},e={top:{in:!0,out:!1,up:!0,down:!1},bottom:{in:!1,out:!0,up:!0,down:!1}},i=(t,o,e,i)=>{const s=/(-{0,1})(.+)(px|%)/.exec(t);let n,r=s[3],l=s[2];const h=o.innerHeight||o.getBoundingClientRect().height;if("px"===i&&"%"===r&&(l=l*h/100,r="px"),n="px"===r?h-l:100-l,"-"===s[1]){const t=n;n=l,l=t}return{rootBorderFromTop:l,rootBorderFromBottom:n,rootBorderUnit:r}},s=(t,o,e)=>{let i,s,n,r,l=e,h=null,u=0;const d=()=>{u=0,h=null,s=t.apply(l,i),h||(l=null,i=null)};return(...e)=>(n=Date.now(),u||(u=n),l=void 0,i=e,(r=o-(n-u))<=0||r>o?(h&&(clearTimeout(h),h=null),u=n,s=t.apply(l,i),h||(l=null,i=null)):h||(h=setTimeout(d,r)),s)},n={init:null,in:null,out:null,delay:150,fromIsBelowTo:!0};export default class{constructor(t,o=null){this.target=t,this.root=o,this.rootEl=o||window,this.observers=[],this.listeners=[]}observe(s,n,r,l,h){let u,d=s;d in t&&(d=t[d]);const c=o[n][r],a=e[n][r],{rootBorderFromTop:p,rootBorderFromBottom:g,rootBorderUnit:v}=i(d,this.rootEl),m=this.rootEl.innerHeight||this.rootEl.getBoundingClientRect().height,w=a?`${this.target.getBoundingClientRect().height+m}px`:`-${p}${v}`,b=a?`-${g}${v}`:`${this.target.getBoundingClientRect().height+m}px`,B=c?0:1,f=new IntersectionObserver(t=>{t.forEach(t=>{if(void 0===u&&"function"==typeof h&&h.call(this,t.rootBounds[a?"bottom":"top"]>t.boundingClientRect[n],t),t.isIntersecting){let o;const e=t.boundingClientRect.y;e>u?o=!1:e<u&&(o=!0),o===a&&!0===t.isIntersecting&&"function"==typeof l&&l.call(this,t)}u=t.boundingClientRect.y})},{root:this.root,threshold:[B],rootMargin:`${w} 0% ${b}`});return f.observe(this.target),this.observers.push(f),this}cancel(){return this.observers.forEach(t=>{t.unobserve(this.target)}),this.listeners.forEach(t=>{window.removeEventListener("scroll",t,!1)}),this}on(t,o,e){const[i,s,n]=t.split(" ");let r=e;return void 0===n?"function"==typeof o?(this.observe(i,s,"up",o,(t,e)=>{t?o(e):r(e)}),this.observe(i,s,"down",t=>{r(t)})):(r=void 0===r||r,this.observe(i,s,"up",()=>{this.target.classList[r?"add":"remove"](...o.split(" "))},t=>{t?this.target.classList[r?"add":"remove"](...o.split(" ")):this.target.classList[r?"remove":"add"](...o.split(" "))}),this.observe(i,s,"down",()=>{this.target.classList[r?"remove":"add"](...o.split(" "))})):this.observe(i,s,n,o,r),this}init(t,o){const[e,i]=t.split(" ");return this.observe(e,i,"up",null,(t,e)=>{o.call(this,t,e)}),this}fromto(t,o,e,r){const[l,h]=t.split(" "),[u,d]=o.split(" "),c={...n,...r||{}};let a,p;const g=i(l,this.rootEl,c.fromIsBelowTo,"px").rootBorderFromTop;let v=i(u,this.rootEl,!c.fromIsBelowTo,"px").rootBorderFromTop-g;"top"===h&&"bottom"===d?v-=this.target.getBoundingClientRect().height:"bottom"===h&&"top"===d&&(v+=this.target.getBoundingClientRect().height);const m=()=>(this.target.getBoundingClientRect()[h]-g)/v;return this.observe(l,h,c.fromIsBelowTo?"up":"down",t=>{a=s(()=>{e.call(this,m(),t)},c.delay),c.in&&c.in.call(this,m(),t),window.addEventListener("scroll",a,!1),p=this.listeners.push(a)-1},(t,o)=>{const i=m();c.init&&c.init.call(this,i,o),i>0&&i<1&&(a=s(()=>{e.call(this,m(),o)},c.delay),c.in&&c.in.call(this,m(),o),window.addEventListener("scroll",a,!1),p=this.listeners.push(a)-1)}),this.observe(u,d,c.fromIsBelowTo?"down":"up",t=>{a=s(()=>{e.call(this,m(),t)},c.delay),c.in&&c.in.call(this,m(),t),window.addEventListener("scroll",a,!1),p=this.listeners.push(a)-1}),this.observe(u,d,c.fromIsBelowTo?"up":"down",t=>{window.removeEventListener("scroll",a,!1),delete this.listeners[p],c.out&&c.out.call(this,m(),t)}),this.observe(l,h,c.fromIsBelowTo?"down":"up",t=>{window.removeEventListener("scroll",a,!1),delete this.listeners[p],c.out&&c.out.call(this,m(),t)}),this}fromTo(...t){return this.fromto(t),this}}
